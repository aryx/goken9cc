# -*- org -*-

* 0.1 (Q4 2025) (compile and run principia pc/pi, 5a/5c/5l/8a/8c/8l v2, mips va/vc/vl v1, riscv ia/ic/il v0, float v0, arm/mips emulator (5i/vi) v0, acid v0)

** toolchain
- import also 8a/8c/8l, 5a/5c/5l, cc, ar, and libmach from my kencc fork
  https://github.com/aryx/fork-kencc put in assemblers/, linkers/, compilers/
  as they are known to work on principia code and I got tired of trying
  to make the golang-origin toolchains working (which are still in src/cmd).
- fix the imported 8a/8c/8l, ar, etc. by changing a few long->int32
  (cc/bits.c, x.out.h ieee float), and use -fsigned-char so it can compile
  principia softwarica from my arm64 machine!
- fix more 8c/5c long->int32 (Node xoffset, Adr offset, ieeedtod, pswt switch sort),
   %ld->%d, %.17e->%e (misleading as display different but binary equal),
  compare .8 produced by goken vs kencc using '-m32 -mfpmath=sse -sse2'
  (for tests/c/misc/f_1_e_126.c)
  and fix mismatches enough so that mostly same .8 
  => can run principia pc and pi targets!!!
- 5a/5c/5l 8a/8c/8l reduce diff with plan9 repo and add Linux ELF support
  (again)
- mips: generate ELF-Linux binaries (can test with qemu-mips)
- support for arm64, riscv, and mips in libmach (imported
  respectively from 9front, inferno-os, and 9-cc).
- import arm and mips emulator 5i/vi from principia (derived from plan9)
- import orginal acid debugger from 9-cc (derived from plan9)
  useful for disassembling (especially because objdump and
  gdb fails on some of the goken9cc generated binaries) and binary
  exploration
- add lex/yacc (generators)

** lib9
- import open.c/_p9dir.c from plan9port which fixed ls/du/tar bugs
  (still some bugs though)
- use nanosecond granularity to new Dir->mtime_ field and fix mk to use this
  new more precise time to avoid useless recompilation
- a few long->int32 in strtod.c (but no impact on principia I think)
- added lib9/fileexists.c to factorize code between linkers and make
  the code more portable

** test infra
- multi-arch testing thanks to qemu (see tests/s/mini/, tests/c/mini/)
- docker build and test working for both amd64 and arm64
- more C tests in tests/c/{float,vlong}
- use principia as a big regression test in docker, and use goken to compile
  all of principia including the kernels for the pi and pc targets!!
- resume shell.nix and nix.yml GHA for Linux and macOS CI checks

** build infra
- support and use "#9/..." paths like in plan9port instead of needing
  special env vars like YACCPAR or RCMAIN (kept for compatibility reasons)
  and pass correct -DGOROOT to goos.c and get9root.c
- started to add GODYNLINK and GOLANG #ifdefs to guard optional
  or golang specific code in the toolchain (defined when building GO/
  but undefined otherwise)
- use gcc -fsigned-char on arm64 to get portable code
- use gcc -fpmath=sse -sse2 on i386 to get portable code and same float behavior
  on 32bits vs 64bits machine
- remove the need for -Wl,--allow-multiple-definition
- fix the code so it can build with clang on macOS


** internals
- convert long -> int32 for 64bits machine and gcc/clang portability
  for 5a_/5c_/5l_, va/vc/vl, ia/ic/il, 7a/7c/7l
  TODO: undo and do the minimum like I did for 5c/8c enough to compile/run
  principia
- convert a few long -> int32 for the kencc imported 5a/5c/6l, 8a/8c/8l
  (but very few; just in cc/bits.c, x.out.h, and a few other places)
- move the different toolchains (ix, vx, ...) in assemblers/, linkers/,
  and compilers/ (and kept the golang-origin one in src/cmd/)

** utilities
- add utilities/calc/hoc from principia useful to compile the principia kernel
- add utilities/kernel/{data2s,ksize}.c useful to compile the principia kernel

* Beta (Q3 2025) (arm64 7a/7c/7l v1, riscv ia/ic/il v0, arm64 linux/macos build, arm32 linux run v0, mk/rc, utilities v0, typesetting v0)

** toolchain
- adapt to goken 7a/7c/7l 
  (working hello_linux_arm64.exe and helloc.exe on my thelio astra)
- adapt to goken ia/ic/il (but not tested and actually still fail in Q4)
- adapt 5a/5c/5l to generate valid arm32 Linux binaries (EABI)
  (working hello_linux_arm.exe, helloc.exe, and helloprintf.exe also
   on my thelio astra which can run both arm64 and arm32 binaries)
- import original 5a/5c/5l from 9cc/plan9 as 5a_/5c_/5l_ and
  extend also to ELF EABI and working hello_linux_arm_.exe

** build
- add mk and rc source code from principia softwarica so self-contained repo with
  build-mk.sh to "bootstrap" mk/rc
- fix mk/rc for unix (RCMAIN, MKSHELL, import PATH, etc.)
  adapting improvements from kencc and plan9port
- add also ed source code from principia softwarica so no need external 'ed' and
  build-mk.sh now build mk, rc, and 'ed'
- adapt to build on arm64 linux and arm64 macos (partial)

** internals
- reorg code with all Go related stuff under GO/ (GOSRC/, GOMISC/, GOTEST/)
- started reorg code with machine/, lib_strings, to match principia-softwarica
- added lib9/math/ subdir and move files there.

** libs
- added libregexp (needed by mk/rc) and libstring (needed by du and rc) from
  principia softwarica or plan9port

** utilities
- add source code of many utilities (cat, cp, grep, ed, diff, etc.) from
  principia softwarica so easier to build and test for principia readers
  and good testsuite for the goken toolchain itself at some point
- add source code of typesetting tools (troff, eqn, tbl, etc.) from
  principia softwarica (actually was not built in principia)


* Alpha (Q2 2025) (focus on C (not Go), Dockerfile/Nix/GHA, mips/arm64/riscv import v0)
# see also pad.org history section

** toolchain
- add mips toolchain va/vl/vc from https://bitbucket.org/plan9-from-bell-labs/9-cc.git
  and adapt it to goken; tested va/vl with vi from principia on hello_plan9_mips.s
- add arm64 toolchain 7a/7l/7c from 9-cc
  (not tested though)
- add riscv toolchain ia/il/ic from https://github.com/inferno-os/inferno-os
  (not tested though)

** internals
- reorg code with Go related toolchain in GOSRC/ and the C toolchain in src/,
  same for test/ renamed GOTEST/
- start move around Go specific files in GOMISC/ (go editor modes, go shell hooks,
  cgo, go docs, cmd/ebnflint)
- remove the Google (and obsolete) specifics: src/cmd/hgpatch and lib/corereview
- remove support for nacl (google native client old technology superseded by wasm)

** test infra
- add Dockerfile.gosrc and docker.yml GHA (Github Action) CI checks,
  and Dockerfile.alpine (just build, no run; does not run unfortunately)
  and Dockerfile.mksrc (just C toolchain)
- add shell.nix and nix.yml GHA for Linux CI checks (but not macOS yet)
- add basic 'make test' and new tests/s/ and tests/c/

** build
- add mkfiles to better match kencc and plan9 build system
- adapt quietgcc to modern Linux (2025) with recent gcc
- adapt quietgcc to modern macOS (2025) with recent clang
- adapt quietgcc to modern Windows (2025) with recent mingw-gcc

* Goken9cc Pre-history

** TODO Cinap 9front: 2019-2025
- many fixes to 7[alc]

** Richard Miller: 2018
- cmd/z[alc]/ for RISC-V (later renamed to i[alc] for riscv and j for riscv64)
in https://9p.io/sources/contrib/miller/

** Charles Forsyth: 2014
- cmd/7[alc] for arm64
in https://bitbucket.org/plan9-from-bell-labs/9-cc/src/master/

** Go pre 1.0: 2008-2010
# see DELETED/doc/devel/release.html for a compact list of changes
# see also 'git log' for a very long list of changes.

*** Go->goken9cc:
fork Go at the October 2010 time to start goken9cc (in May 2025).

*** linker
+ ELF for Linux
+ Mach-O for macOS
+ PE for Windows

+ DWARF for gdb

*** C compilers

*** runtime
+ Linux (x86, amd64)
+ macOS (amd64)
+ Windows (x86) (amd64 support is post Go 1.0)
+ FreeBSD
+ Android (arm)

*** Inferno and plan9port->Go:
- Import [568][acl] and libbio/ from Inferno-os/utils around june 2008
- Import lib9/ from plan9port around june 2008

** Plan9port: 2001?-2007?
- lib9/ to make portable the plan9 compiler
- adapt mk/rc to Unix
 
** Inferno-os: 1995-1997
- make portable the plan9 compiler (with help from plan9port) with lib9/
  that can be built ("hosted") from Linux, macOS, Windows, FreeBSD, ...

** Plan 9: 1985-2002
Most of the code in goken9cc comes from Plan 9 4th edition:
- cmd/[05678qtv][alc]/ cc/ and libmach/
  a multiarch assembler, linker, C compiler toolchain
- libc/, libbio/
  a new minimalist C library (far smaller than glibc or musl)
- cmd/{mk,rc, acid, ...}
  simplified/redesigned versions of Unix tools
- cmd/{ed,grep,diff,cat, ...} utilities
- libregexp/, libstring/
  minimalist C libraries

** Unix (6th edition at least): 1976
the origin:
- lex
- yacc

* Template 0.X (Qx 2025) (major-contrib)

** toolchain

** test infra

** dev infra

** build infra

** internals

** os

** arch
